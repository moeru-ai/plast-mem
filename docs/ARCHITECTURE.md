# Plast Mem Architecture Overview

## Project Structure

Plast Mem is an experimental llm memory layer for cyber waifu. The codebase is a Cargo workspace with separate crates for each layer.

## Crates

### 1. plastmem

Entry program. Initializes tracing, database connection, migrations, job storage, and spawns the worker and server tasks.

**Key Components**:
- `main.rs`: Application bootstrap

### 2. plastmem_core

Core structure

**Key Components**:
- `memory/`: Various types of memory
  - `episodic.rs`: Episodic Memory (hybrid retrieval with FSRS re-ranking)
- `message_queue.rs`: Message Queue (rule-based segmentation triggers)

### 3. plastmem_migration

Database table migrations

**Key Components**:
- `m**.rs`: Migration files

### 4. plastmem_entities

Database table entities, generated by `sea-orm-cli`

**Key Components**:
- `episodic_memory.rs`: Episodic Memory entity
- `message_queue.rs`: Message Queue entity

### 5. plastmem_ai

Wrapped AI SDK

**Key Components**:
- `embed.rs`: Create embeddings
- `generate_text.rs`: Create chat completion
- `generate_object.rs`: Create structured output (JSON Schema)
- `lib.rs`: Event segmentation analysis (`segment_events`)

### 6. plastmem_shared

Reusable utilities

**Key Components**:
- `env.rs`: Global app environment
- `error.rs`: Global app error

### 7. plastmem_worker

Background tasks worker

**Key Components**:
- `event_segmentation.rs`: Creates episodic memories with surprise-based FSRS initialization
- `memory_review.rs`: Updates FSRS parameters on retrieval

### 8. plastmem_server

HTTP server and API handlers

**Key Components**:
- `api/`: Public HTTP API
  - `add_message.rs`: Message ingestion endpoint
  - `retrieve_memory.rs`: Memory retrieval endpoints (raw JSON and formatted)
- `utils/`: Server-specific utilities
  - `state.rs`: AppState (database + job storage)
  - `shutdown_signal.rs`: Graceful shutdown handling
- `server.rs`: Axum HTTP server setup

## Further Reading

- [Segmentation](architecture/segmentation.md) - Segmenter Based on Rule and Event Segmentation Theory
- [FSRS](architecture/fsrs.md) - Integration with FSRS (Free Spaced Repetition Scheduler)
